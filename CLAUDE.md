# CLAUDE.md - AI Assistant Guide for Chelsea Hair Clinic Website

## Project Overview

This is the website for **Chelsea Hair Clinic** (chelseahairclinic.co.uk), a holistic medical and surgical hair restoration clinic based in London. The site is built using Hugo static site generator with the Docsy documentation theme.

**Site URL**: https://chelseahairclinic.co.uk
**Repository**: https://github.com/mavviepug/chelseahairclinic.co.uk
**Primary Branch**: `main`
**Deploy Branch**: `deploy` (auto-generated by CircleCI)

## Technology Stack

### Core Technologies
- **Hugo**: v0.146.0+ (extended version required)
- **Docsy Theme**: v0.12.0 (imported as Hugo module)
- **Node.js**: LTS version (see `.nvmrc`)
- **Go**: v1.12+ (for Hugo modules)
- **Docker**: Available for containerized development

### Build Tools
- **PostCSS**: For CSS processing
- **Autoprefixer**: Automatic vendor prefixes
- **RTLCSS**: Right-to-left CSS support for Farsi
- **npm**: Package management and task runner

### CI/CD & Deployment
- **CircleCI**: Continuous integration and deployment
- **Netlify**: Alternative deployment platform (configured)
- **GitHub Actions**: Repository automation

## Repository Structure

```
chelseahairclinic.co.uk/
├── .circleci/          # CircleCI configuration
│   └── config.yml      # Build and deploy pipeline
├── .github/            # GitHub-specific files
│   └── dependabot.yml  # Dependency updates configuration
├── assets/             # Site assets
│   └── scss/           # Custom SCSS/CSS
│       └── _variables_project.scss
├── content/            # Site content (markdown files)
│   ├── en/            # English content (default)
│   │   ├── _index.md  # Homepage
│   │   ├── about/     # About page
│   │   ├── blog/      # Blog posts
│   │   │   ├── news/
│   │   │   └── releases/
│   │   ├── docs/      # Documentation
│   │   │   ├── getting-started/
│   │   │   ├── tasks/
│   │   │   ├── tutorials/
│   │   │   └── reference/
│   │   └── community/ # Community page
│   ├── fa/            # Farsi (Persian) content
│   └── no/            # Norwegian content
├── layouts/            # Custom Hugo layouts/templates
│   ├── _markup/       # Markdown rendering customization
│   └── 404.html       # Custom 404 page
├── .cspell.yml         # Spell check configuration
├── .gitignore          # Git ignore rules
├── .nvmrc              # Node.js version specification
├── config.yaml         # Old config (see hugo.yaml instead)
├── CONTRIBUTING.md     # Contribution guidelines
├── docker-compose.yaml # Docker Compose configuration
├── Dockerfile          # Docker image definition
├── docsy.work          # Hugo workspace for local Docsy development
├── go.mod              # Go module dependencies
├── go.sum              # Go module checksums
├── hugo.yaml           # Main Hugo configuration file
├── LICENSE             # Apache 2.0 license
├── netlify.toml        # Netlify deployment configuration
├── package.json        # Node.js dependencies and scripts
└── README.md           # Project documentation
```

## Development Workflows

### Local Development Setup

1. **Prerequisites**:
   ```bash
   # Ensure Hugo extended 0.146.0+ is installed
   hugo version

   # Use correct Node.js version
   nvm use  # Uses version from .nvmrc

   # Install dependencies
   npm install

   # Initialize Hugo modules
   hugo mod clean --all
   hugo mod tidy
   hugo mod get
   ```

2. **Start Development Server**:
   ```bash
   # Using npm script (recommended)
   npm run serve

   # Or directly with Hugo
   hugo server

   # Access site at http://localhost:1313
   ```

3. **Using Docker** (alternative):
   ```bash
   # Build and run container
   docker-compose up --build

   # Stop container
   # Ctrl+C, then:
   docker-compose rm
   ```

4. **Working with Local Docsy Clone**:
   ```bash
   # Clone Docsy theme to parent directory
   cd /path/to/chelseahairclinic.co.uk/..
   git clone --branch v0.12.0 https://github.com/google/docsy.git docsy

   # Run with workspace
   npm run local serve
   ```

### npm Scripts Reference

```json
"build": "npm run _build --"                    // Development build
"build:preview": "..."                          // Preview build for Netlify
"build:production": "npm run _hugo -- --minify" // Production build
"serve": "npm run _serve"                       // Start dev server
"clean": "rm -Rf public/* resources"            // Clean build artifacts
"test": "npm run check:links"                   // Run tests (link checking)
"update:hugo": "..."                            // Update Hugo version
"update:pkgs": "npx npm-check-updates -u"       // Update all packages
```

### Content Creation

#### Creating New Pages

1. **Blog Posts**:
   ```bash
   hugo new content/en/blog/news/my-post/index.md
   ```

2. **Documentation**:
   ```bash
   hugo new content/en/docs/section/page.md
   ```

3. **Front Matter Template**:
   ```yaml
   ---
   title: "Page Title"
   description: "Page description for SEO"
   date: 2024-01-01
   weight: 10  # For ordering in navigation
   ---
   ```

#### Multi-language Content

- **English (default)**: `content/en/`
- **Norwegian**: `content/no/`
- **Farsi**: `content/fa/` (RTL layout enabled)

Always create content in the appropriate language directory.

### Theme Customization

#### SCSS Variables
Custom variables: `assets/scss/_variables_project.scss`

Override Docsy variables here. Changes will be picked up by Hugo's asset pipeline.

#### Custom Layouts
Place custom templates in `layouts/` to override theme defaults.

Common overrides:
- `layouts/index.html` - Homepage
- `layouts/_default/baseof.html` - Base template
- `layouts/partials/` - Partial templates

## Configuration Deep Dive

### hugo.yaml Key Settings

```yaml
baseURL: https://chelseahairclinic.co.uk
title: Chelsea Hair Clinic
contentDir: content/en                    # Default content directory
defaultContentLanguage: en
defaultContentLanguageInSubdir: false
enableGitInfo: true                       # Use Git for lastmod dates
enableRobotsTXT: true                     # Generate robots.txt

# Multi-language setup
languages:
  en:
    languageName: English
    params:
      description: "Chelsea Hair Clinic - Holistic Medical & Surgical Hair Restoration Experts"
  'no':
    languageName: Norsk
    contentDir: content/no
  fa:
    languageDirection: rtl                # Right-to-left for Persian
    languageName: "فارسی (Persian)"
    contentDir: content/fa

# Important parameters
params:
  github_repo: https://github.com/google/docsy-example  # Update if needed
  github_branch: main
  gcs_engine_id: d72aa9b2712488cc3       # Google Custom Search
  offlineSearch: false                   # Lunr.js search disabled
  ui:
    navbar_logo: true
    sidebar_menu_compact: false
    feedback:
      enable: true                       # Show feedback section on docs

module:
  hugoVersion:
    extended: true
    min: 0.146.0
  imports:
    - path: github.com/google/docsy
      disable: false
```

## CI/CD Pipeline

### CircleCI Workflow

**File**: `.circleci/config.yml`

**Workflow**: `build-and-deploy`
1. **Build Job** (on `main` branch):
   - Checkout code
   - Install Hugo modules
   - Install npm dependencies
   - Build site → `workspace/public`
   - Persist workspace

2. **Push Build Job**:
   - Attach workspace
   - Clone `deploy` branch
   - Copy `public` to deployment
   - Commit and push to `deploy` branch

**Branch Protection**:
- Only builds on `main` branch
- Auto-deploys to `deploy` branch

### Netlify Deployment

**File**: `netlify.toml`

- **Preview**: `npm run build:preview`
- **Production**: `npm run build:production`
- **Go Version**: 1.22.2
- **Publish Directory**: `public`

## Git Conventions

### Branch Naming
- **Main branch**: `main`
- **Feature branches**: `claude/feature-name-sessionid`
- **Deploy branch**: `deploy` (auto-managed, do not commit directly)

### Commit Messages
Follow conventional commits style:
- `feat: add new treatment page`
- `fix: correct navigation menu`
- `docs: update README`
- `style: improve homepage layout`
- `refactor: reorganize content structure`
- `chore: update dependencies`

### Git User Configuration
When committing via CI:
```bash
git config user.name "mavviepug"
git config user.email "mavviepug@users.noreply.github.com"
```

## Key Conventions for AI Assistants

### Content Editing Guidelines

1. **File Locations**:
   - Homepage: `content/en/_index.md`
   - Navigation: Controlled by Hugo front matter (`weight` parameter)
   - Images: Place near content files or in `static/` directory

2. **Shortcodes** (Hugo templating):
   - `{{< blocks/cover >}}` - Hero sections
   - `{{% blocks/lead %}}` - Lead sections
   - `{{% blocks/section %}}` - Content sections
   - `{{% blocks/feature %}}` - Feature blocks

3. **Image Handling**:
   - Featured images: `featured-*.{jpg,png}` in page bundle
   - Static assets: Place in `static/` directory
   - Referenced in content: `/path/from-static/`

### Configuration Changes

1. **Always edit**: `hugo.yaml` (not `config.yaml`)
2. **Module changes**: Run `hugo mod tidy` after editing `go.mod`
3. **SCSS changes**: Restart `hugo server` to see updates

### Testing Changes

Before committing:
```bash
# Build production version
npm run build:production

# Check for errors
# View output in public/ directory

# Test links (if configured)
npm test
```

### Common Tasks for AI Assistants

#### Task: Update Homepage Content
1. Edit `content/en/_index.md`
2. Modify markdown between shortcodes
3. Test locally: `npm run serve`
4. Commit changes

#### Task: Add New Documentation Page
1. Create file: `content/en/docs/section/page.md`
2. Add front matter with title, description, weight
3. Write content in Markdown
4. Update parent `_index.md` if needed
5. Test navigation

#### Task: Modify Site Configuration
1. Edit `hugo.yaml`
2. Update relevant section (params, languages, etc.)
3. Restart Hugo server
4. Verify changes

#### Task: Add Custom Styling
1. Edit `assets/scss/_variables_project.scss`
2. Add SCSS variables or custom styles
3. Hugo will recompile automatically

#### Task: Update Dependencies
```bash
# Update Hugo
npm run update:hugo

# Update npm packages
npm run update:pkgs

# Update Hugo modules
hugo mod get -u
hugo mod tidy
```

## Troubleshooting

### Common Issues

1. **"Module not compatible" error**:
   - Check Hugo version: `hugo version` (must be 0.146.0+)
   - Ensure extended version is installed

2. **"TOCSS: failed to transform" error**:
   - Install extended Hugo version
   - Run `npm install` for PostCSS dependencies

3. **"binary with name 'go' not found"**:
   - Install Go 1.12 or higher
   - Ensure Go is in PATH

4. **Module cache issues**:
   ```bash
   hugo mod clean --all
   hugo mod get
   hugo mod tidy
   ```

5. **Build artifacts causing issues**:
   ```bash
   npm run clean
   ```

## Security Considerations

1. **Never commit**:
   - Environment variables
   - Tokens or API keys
   - `GITHUB_TOKEN` (used in CircleCI only)
   - `node_modules/`, `public/`, `resources/` (in `.gitignore`)

2. **Dependencies**:
   - Dependabot is configured (`.github/dependabot.yml`)
   - Review and merge security updates promptly

3. **Content Security**:
   - Sanitize user-generated content
   - Be cautious with `unsafe: true` in Goldmark renderer
   - Validate external links

## Links & Resources

- **Hugo Documentation**: https://gohugo.io/documentation/
- **Docsy Documentation**: https://www.docsy.dev/docs/
- **Docsy GitHub**: https://github.com/google/docsy
- **Hugo Modules**: https://gohugo.io/hugo-modules/

## Contact & Contribution

- **Repository Owner**: mavviepug
- **License**: Apache 2.0
- **Contribution**: See `CONTRIBUTING.md` for guidelines

## Notes for AI Assistants

1. **Always read files before editing** to understand current state
2. **Use Hugo best practices** for content organization
3. **Test changes locally** before committing
4. **Follow multi-language structure** when editing content
5. **Respect the Docsy theme architecture** - use overrides, not modifications
6. **Update this CLAUDE.md** if project structure changes significantly
7. **Branch naming must follow pattern**: `claude/*-sessionid` for push permissions
8. **Build before pushing**: Ensure `npm run build:production` succeeds
9. **CircleCI deploys from main**: Only `main` branch triggers deployment
10. **Check existing patterns**: Review similar content/pages before creating new ones

## Quick Reference Commands

```bash
# Development
npm run serve                    # Start dev server
npm run build                    # Build for development
npm run build:production         # Build for production
npm run clean                    # Clean build artifacts

# Docker
docker-compose up --build        # Run in container
docker-compose rm                # Clean up containers

# Hugo
hugo server                      # Start server
hugo mod get                     # Download modules
hugo mod tidy                    # Clean module dependencies
hugo new content/en/path/file.md # Create new content

# Dependencies
npm install                      # Install dependencies
npm run update:pkgs             # Update packages
hugo mod get -u                 # Update Hugo modules

# Testing
npm test                        # Run tests (link checking)
hugo version                    # Check Hugo version
node --version                  # Check Node version
```

---

**Last Updated**: 2025-12-09
**Hugo Version**: 0.147.9 (via npm)
**Docsy Version**: 0.12.0
**AI Assistant**: This file should be consulted before making any changes to the repository.
